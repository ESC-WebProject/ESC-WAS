<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸</title>
</head>
<body>
<h2>ë¡œê·¸ì¸ í˜ì´ì§€</h2>
<form id="loginForm">
    <label for="username">ì•„ì´ë””:</label>
    <input type="number" id="username" name="username" required>
    <br>
    <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
    <input type="password" id="password" name="password" required>
    <br>
    <button type="submit">ë¡œê·¸ì¸</button>
</form>

<p id="message"></p>
<div id="jwtContainer" style="display: none;">
    <h3>JWT í† í°:</h3>
    <textarea id="jwtToken" rows="5" cols="50" readonly></textarea>
    <br>
    <button onclick="copyToken()">ğŸ“‹ ë³µì‚¬</button>
</div>

<script>
    document.getElementById("loginForm").addEventListener("submit", async function(event) {
        event.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë§‰ê¸°

        const studentId = Number(document.getElementById("username").value);
        const pwd = document.getElementById("password").value;

        console.log("ğŸ”¹ ì „ì†¡ ë°ì´í„°:", { studentId, pwd });

        const response = await fetch("/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ studentId, pwd })
        });

        const messageEl = document.getElementById("message");
        const jwtContainer = document.getElementById("jwtContainer");
        const jwtTokenField = document.getElementById("jwtToken");

        const data = await response.json();  // ğŸ”¹ JSON ì‘ë‹µ ë°›ê¸°
        console.log("ğŸ”¹ ì„œë²„ ì‘ë‹µ:", data); // ğŸ”¥ JSON êµ¬ì¡° í™•ì¸ìš© ë¡œê·¸

        if (response.ok) {
            const token = data.jwt; // `{ "jwt": "í† í°ê°’" }` í˜•ì‹

            if (!token) {
                messageEl.textContent = "âŒ ë¡œê·¸ì¸ ì„±ê³µí–ˆì§€ë§Œ, í† í°ì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                messageEl.style.color = "orange";
                return;
            }

            // ğŸ”¥ JWTë¥¼ ì¿ í‚¤ì— ì €ì¥ (ìœ íš¨ì‹œê°„: 1ì‹œê°„)
            document.cookie = `jwtToken=${token}; path=/; max-age=3600; secure`;

            messageEl.textContent = "âœ… ë¡œê·¸ì¸ ì„±ê³µ! 3ì´ˆ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
            messageEl.style.color = "green";

            // JWT í† í° í‘œì‹œ
            jwtTokenField.value = token;
            jwtContainer.style.display = "block";

            // ğŸ”¥ 3ì´ˆ í›„ `index.html`ë¡œ ì´ë™
            setTimeout(() => {
                window.location.href = "/index.html";
            }, 3000);
        } else {
            messageEl.textContent = "âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨! ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸";
            messageEl.style.color = "red";
            jwtContainer.style.display = "none";
        }
    });

    // ğŸ“‹ JWT ë³µì‚¬ ê¸°ëŠ¥
    function copyToken() {
        const jwtTokenField = document.getElementById("jwtToken");
        jwtTokenField.select();
        document.execCommand("copy");
        alert("JWT í† í°ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹");
    }
</script>

</body>
</html>
